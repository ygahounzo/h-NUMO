#NUMALIBS=-L$(NUMA_DIR)/libs -lRRTM
NUMALIBS=-L$(NUMA_DIR)/libs

#-------------------
# Single precision
# -----------------

#R8=-DSINGLE
R8=-r8

#BORAH_P4EST_DIR := /bsushare/mkopera-shared/p4est-2.2/local
BORAH_P4EST_DIR := $(NUMA_DIR)/p4est/local
BORAH_OCCA_DIR := $(NUMA_DIR)/occa
BORAH_METIS := $(NUMA_DIR)/metis
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$BORAH_P4EST_DIR/lib"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$BORAH_P4EST_DIR/local"
borah:
	$(MAKE) $(TARGET) \
	"FC=mpif90" \
	"LD=mpif90" \
	"CC=mpicc" \
	"FFLAGS=-O2 -fdefault-real-8 -finit-real=zero -ffree-line-length-none" \
	"CFLAGS=-O2 -Wconversion -Wno-sign-conversion -Wcast-align -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -Wformat-security -pedantic -Wextra -Wno-unused-parameter -std=c99 -I${BORAH_P4EST_DIR}/local/include" \
	"INCLUDE= -I${BORAH_P4EST_DIR}/include  -I${NUMA_DIR}/include -I${BORAH_METIS}/include" \
	"LIBS=$(NUMALIBS) -L${BORAH_P4EST_DIR}/lib  -L/usr/lib -L${BORAH_METIS}/lib -lmetis -lp4est -lsc -llapack -lblas -lz" \
	"AR=ar rv"

borah-debug:
	$(MAKE) $(TARGET) \
	"FC=mpif90" \
	"LD=mpif90" \
	"CC=mpicc" \
	"FFLAGS=-O0 -fdefault-real-8 -finit-real=zero -fbacktrace -fbounds-check -ffpe-trap=invalid,zero,overflow -g -ffree-line-length-none -Wall" \
	"CFLAGS=-O0 -Wconversion -Wno-sign-conversion -Wcast-align -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -Wformat-security -pedantic -Wextra -Wno-unused-parameter -std=c99" \
	"INCLUDE= -I${BORAH_P4EST_DIR}/include  -I${NUMA_DIR}/include -I${BORAH_METIS}/include" \
	"LIBS=$(NUMALIBS) -L${BORAH_P4EST_DIR}/lib  -L/usr/lib -L${BORAH_METIS}/lib -lmetis -lp4est -lsc -llapack -lblas -lz" \
	"AR=ar rv"

FALCON_P4EST_DIR := $(NUMA_DIR)/p4est/local
FALCON_OCCA_DIR := $(NUMA_DIR)/occa
FALCON_METIS := $(NUMA_DIR)/metis
#export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$FALCON_P4EST_DIR/lib"
#export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$FALCON_P4EST_DIR/local"
falcon:
	$(MAKE) $(TARGET) \
	"FC=mpif90" \
	"LD=mpif90 -Wl,--allow-multiple-definition" \
	"CC=mpicc" \
	"FFLAGS=-O2 -fdefault-real-8 -finit-real=zero -ffree-line-length-none -Wl,--allow-multiple-definition" \
	"CFLAGS=-O2 -Wconversion -Wno-sign-conversion -Wcast-align -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -Wformat-security -pedantic -Wextra -Wno-unused-parameter -std=c99 -Wl,--allow-multiple-definition" \
	"INCLUDE= -I${FALCON_P4EST_DIR}/include  -I${NUMA_DIR}/include -I${FALCON_METIS}/include" \
	"LIBS=$(NUMALIBS) -L${FALCON_P4EST_DIR}/lib  -L/usr/lib -L${FALCON_METIS}/lib -lmetis -lp4est -lsc -llapack -lblas -lz" \
	"AR=ar rv"

#------------------------------------------------------------------------------
# Flags for building NUMA on Mac OS X with gcc on MACBOOK using Homebrew with p4est library option
# user must install gcc openmpi metis netcdf vtk using Homebrew
#------------------------------------------------------------------------------
OMPI_COMPILE_BREW := /usr/local/bin
P4EST_DIR_BREW := $(NUMA_DIR)/p4est/local
NETCDF_DIR_BREW := /usr/local
METIS_DIR_BREW := /usr/local/lib
SUPERLU_DIR_BREW := $(NUMA_DIR)/superlu

macbook-p4est-brew:	
	$(MAKE) $(TARGET) \
	"FC=${OMPI_COMPILE_BREW}/mpif90" \
	"LD=${OMPI_COMPILE_BREW}/mpif90" \
	"CC=${OMPI_COMPILE_BREW}/mpicc" \
	"FFLAGS=-O2 -fdefault-real-8 -finit-real=zero -ffree-line-length-none" \
	"CFLAGS=-O2 -Wconversion -Wno-sign-conversion -Wcast-align -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -Wformat-security -pedantic -Wextra -Wno-unused-parameter -std=c99" \
	"INCLUDE=-I${NETCDF_DIR_BREW}/include -I${P4EST_DIR_BREW}/include -I$(NUMA_DIR)/include" \
	"LIBS=$(NUMALIBS) -L${NETCDF_DIR_BREW}/lib -L${P4EST_DIR_BREW}/lib -L/usr/local/lib -lnetcdff -lnetcdf -L${METIS_DIR_BREW} -lmetis -lp4est -lsc -llapack -lblas" \
	"AR=ar rv"

macbook-p4est-brew-dbg:	
	$(MAKE) $(TARGET) \
	"FC=${OMPI_COMPILE_BREW}/mpif90" \
	"LD=${OMPI_COMPILE_BREW}/mpif90" \
	"CC=${OMPI_COMPILE_BREW}/mpicc" \
	"FFLAGS=-O2 -fdefault-real-8 -finit-real=zero -ffree-line-length-none -Og -g -fcheck=all,no-mem,no-pointer -fbacktrace -ffpe-trap=invalid,zero,overflow,underflow" \
	"CFLAGS=-O2 -Wconversion -Wno-sign-conversion -Wcast-align -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -Wformat-security -pedantic -Wextra -Wno-unused-parameter -std=c99" \
	"INCLUDE=-I${NETCDF_DIR_BREW}/include -I${P4EST_DIR_BREW}/include -I$(NUMA_DIR)/include" \
	"LIBS=$(NUMALIBS) -L${NETCDF_DIR_BREW}/lib -L${P4EST_DIR_BREW}/lib -L/usr/local/lib -lnetcdff -lnetcdf -L${METIS_DIR_BREW} -lmetis -lp4est -lsc -llapack -lblas" \
	"AR=ar rv"

#------------------------------------------------------------------------------
# Default rules
#------------------------------------------------------------------------------
%.o $(OBJDIR)/%.o : %.f
	$(FC) -c $(FFLAGS) $(INCLUDE) $< -o $@

%.o $(OBJDIR)/%.o : %.f90
	$(FC) -c $(FFLAGS) $(INCLUDE) $< -o $@

%.o $(OBJDIR)/%.o : %.F
	$(FC) -c $(FFLAGS) $(INCLUDE) $(CPPFLAGS) $< -o $@

%.o $(OBJDIR)/%.o : %.F90
	$(FC) -c $(FFLAGS) $(INCLUDE) $(CPPFLAGS) $< -o $@

%.o $(OBJDIR)/%.o : %.c
	$(CC) -c $(CFLAGS) $(INCLUDE) $(CPPFLAGS) $< -o $@

modmv:
	mods=`ls *.mod 2> /dev/null` ; \
    if [ "$${mods}" != "" ]; then /bin/mv $${mods} $(NUMA_DIR)/include ; fi
#------------------------------------------------------------------------------
# End default rules
#------------------------------------------------------------------------------
